<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Cantor-ish staircase</title>
    <script src="js/ladder.js"></script>
    <link rel="stylesheet" href="i/main.css">
</head>
<body>
    <canvas id="draw" class="debug" width="100" height="100"></canvas>
    <div id="footer" align="center">
        <form>
            <input name="pattern" id="pattern">
            <input type="submit" value="draw">
        </form>
    </div>
    <script>
        'use strict';

        const reNum  = '(?:[-+]?\\d+(?:\\.\\d+)?)';
        const rePair = new RegExp(`^(?:(${reNum}):)?(${reNum})$`);

        function draw(ladder, canvas) {
            const ctx   = canvas.getContext('2d');
            const w     = canvas.width;
            const h     = canvas.height;
            const graph = ladder.scale(w, h, {flip:true, round:true} );

            ctx.beginPath();
            ctx.strokeStyle = "#555555";
            console.log( 'width:', ctx.lineWidth );
            ctx.lineWidth = 0.5;
            console.log( 'width:', ctx.lineWidth );

            for (let i of graph) {
                ctx.moveTo(i[0], i[1]);
                ctx.lineTo(i[2], i[3]);
            };

            ctx.stroke();
        };

        const param = new URL(window.location).searchParams;
        const pattern = param.get('pattern') ?? '1,0,1';
        document.getElementById('pattern').value = pattern;
        const list = pattern.split(',').map(parsePair);

        let ladder = new Staircase();
        ladder.add(list);
        ladder = ladder.compose(ladder);
        ladder = ladder.compose(ladder);
        ladder = ladder.compose(ladder);

        function redraw(ev) {
            const footer  = document.getElementById('footer');
            const canvas  = document.getElementById('draw');
            canvas.width  = window.innerWidth;
            // Sorry for 2* below, shouldn't be that way :-/
            canvas.height = window.innerHeight - 2 * footer.clientHeight;
            draw(ladder, canvas);
        };

        window.addEventListener('resize', redraw);
        redraw();
        
        function parsePair(str) {
            const [_, first, second] = str.match(rePair);
            return [ Number.parseFloat(first ?? 1), Number.parseFloat(second) ];
        };
    </script>
</body>
</html>
