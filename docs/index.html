<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Cantor-ish staircase</title>
    <script src="js/ladder.js"></script>
    <link rel="stylesheet" href="i/main.css">
</head>
<body>
    <canvas id="draw" class="debug" width="800" height="400"></canvas>
    <script>
        'use strict';

        const reNum  = '(?:[-+]?\\d+(?:\\.\\d+)?)';
        const rePair = new RegExp(`^(?:(${reNum}):)?(${reNum})$`);

        function draw(ladder, canvas) {
            const ctx   = canvas.getContext('2d');
            const w     = canvas.width;
            const h     = canvas.height;
            const graph = ladder.graph(w, h);

            ctx.beginPath();
            ctx.strokeStyle = "#555555";
            ctx.moveTo(0, h);

            for (let i = 0; i < w; i++)
                ctx.lineTo( i, h - graph[i] );

            ctx.stroke();
        };

        const param = new URL(window.location).searchParams;

        console.log(param);

        const pattern = param.get('pattern') ?? '1,0,1';

        const list = pattern.split(',').map(parsePair);

        console.log(list);

        let ladder = new Staircase();
        ladder.add(list);
        ladder = ladder.compose(ladder);
        ladder = ladder.compose(ladder);
        ladder = ladder.compose(ladder);

        draw(ladder, document.getElementById('draw'));
        
        function parsePair(str) {
            const [_, first, second] = str.match(rePair);
            return [ Number.parseFloat(first ?? 1), Number.parseFloat(second) ];
        };
    </script>
</body>
</html>
